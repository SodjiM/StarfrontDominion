<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starfront: Dominion - Game</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }
        
        /* Main layout grid */
        .game-container {
            display: grid;
            grid-template-columns: 280px 1fr 380px;
            grid-template-rows: 64px 1fr minmax(240px, 28vh);
            grid-template-areas:
                "topbar topbar topbar"
                "leftpanel map rightpanel"
                "minimap log rightpanel";
            height: 100dvh; /* avoids OS/taskbar overlap */
            gap: 8px;
            padding: 8px;
        }
        
        /* Top bar */
        .top-bar { grid-area: topbar; display: flex; justify-content: space-between; align-items: center; padding: 0 16px; }
        
        .game-info {
            display: flex;
            align-items: center;
            gap: 30px;
        }
        
        .game-title { font-size: 1.2em; color: var(--primary); }
        
        .turn-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .turn-counter { background: rgba(100,181,246,0.18); padding: 5px 12px; border-radius: 999px; font-weight: bold; }
        
        /* lock-turn-btn inherits from sf-btn */
        .lock-turn-btn.locked { background: linear-gradient(180deg, rgba(255,152,0,0.35), rgba(255,152,0,0.18)); border-color: rgba(255,152,0,0.45); }
        
        /* Left panel - Units list */
        .left-panel { grid-area: leftpanel; padding: 12px; overflow-y: auto; }
        
        .panel-title { font-size: 1.05em; margin-bottom: 10px; color: var(--primary); border-bottom: 1px solid var(--border); padding-bottom: 6px; }
        
        .unit-item { background: rgba(255,255,255,0.04); border: 1px solid var(--border); border-radius: 10px; padding: 10px; margin-bottom: 10px; cursor: pointer; }
        .unit-item:hover { border-color: rgba(99,167,255,0.35); background: rgba(255,255,255,0.06); }
        .unit-item.selected { border-color: rgba(102,187,106,0.6); background: rgba(102,187,106,0.12); }
        
        .unit-name {
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .unit-details { font-size: 0.9em; color: var(--muted); }
        
        /* Player section styles */
        .player-section { display: flex; flex-direction: column; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border); }
        
        .player-avatar {
            margin-bottom: 10px;
        }
        
        .player-avatar img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid rgba(100, 181, 246, 0.5);
            object-fit: cover;
        }
        
        .player-assets-btn {
            background: linear-gradient(45deg, #1976d2, #1565c0);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .player-assets-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(25, 118, 210, 0.3);
        }
        
        /* Center map area */
        .map-container { grid-area: map; position: relative; overflow: hidden; }
        
        #gameCanvas {
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .map-controls { position: absolute; top: 10px; right: 10px; display: flex; gap: 6px; }
        
        /* map-btn inherits from sf-btn */
        
        /* Right panel - Selected unit info */
        .right-panel { grid-area: rightpanel; padding: 12px; overflow-y: auto; }
        
        .unit-info {
            margin-bottom: 20px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* action-btn inherits from sf-btn */
        
        /* Mini-map */
        .mini-map { grid-area: minimap; padding: 10px; display: grid; grid-template-rows: auto 1fr; }
        
        #miniCanvas { width: 100%; height: 100%; border: 1px solid var(--border); border-radius: 8px; }
        
        /* Activity log */
        .activity-log { grid-area: log; padding: 12px; overflow-y: auto; }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            font-size: 0.9em;
        }
        
        .log-entry.info { border-left: 3px solid #2196f3; }
        .log-entry.success { border-left: 3px solid #4caf50; }
        .log-entry.warning { border-left: 3px solid #ff9800; }
        .log-entry.error { border-left: 3px solid #f44336; }
        
        /* Loading and error states */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #64b5f6;
            font-size: 1.2em;
        }
        
        .error {
            color: #f44336;
            text-align: center;
            padding: 20px;
        }
        
        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .game-container {
                grid-template-columns: 200px 1fr 250px;
            }
        }
        
        @media (max-width: 768px) {
            .game-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto 1fr auto auto;
                grid-template-areas:
                    "topbar"
                    "leftpanel"
                    "map"
                    "rightpanel"
                    "log";
            }
            
            .left-panel, .right-panel {
                max-height: 200px;
            }
        }
        
        /* Modal System Styles */
        .game-modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(12, 12, 30, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.2s ease-out;
        }

        .game-modal-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            min-width: 400px;
            max-width: 80vw;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        .game-modal-header {
            background: rgba(100, 181, 246, 0.1);
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .game-modal-header h2 {
            margin: 0;
            color: #64b5f6;
            font-size: 1.3em;
        }

        .modal-close {
            background: none;
            border: none;
            color: #ffffff;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .game-modal-content {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .game-modal-actions {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .game-modal-actions .btn {
            min-width: 100px;
        }

        /* Disable interactions when modal is active */
        .game-container.modal-active {
            pointer-events: none;
            filter: brightness(0.7) blur(1px);
            transition: filter 0.2s ease-out;
        }

        /* Modal animations */
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes modalSlideIn {
            from { 
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Setup form specific styles */
        .setup-form {
            display: grid;
            gap: 20px;
        }

        .form-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .form-section h3 {
            margin: 0 0 15px 0;
            color: #64b5f6;
            font-size: 1.1em;
        }

        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
        }

        .avatar-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .avatar-option:hover {
            border-color: #64b5f6;
            transform: translateY(-2px);
        }

        .avatar-option.selected {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.1);
        }

        .avatar-option img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-bottom: 8px;
            object-fit: cover;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }

        .avatar-option.selected img {
            border-color: #4caf50;
        }

        .color-picker-group {
            display: flex;
            gap: 15px;
        }

        .color-picker {
            flex: 1;
        }

        .color-picker label {
            display: block;
            margin-bottom: 5px;
            color: #b0bec5;
        }

        .color-picker input[type="color"] {
            width: 100%;
            height: 40px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: none;
        }

        .archetype-grid {
            display: grid;
            gap: 10px;
        }

        .archetype-card {
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .archetype-card:hover {
            border-color: #64b5f6;
            transform: translateY(-2px);
        }

        .archetype-card.selected {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.1);
        }

        .archetype-card h4 {
            margin: 0 0 8px 0;
            color: #64b5f6;
        }

        .archetype-card p {
            margin: 0 0 8px 0;
            color: #b0bec5;
            font-size: 0.9em;
        }

        .archetype-bonus {
            color: #4caf50;
            font-weight: bold;
            font-size: 0.9em;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1em;
        }

        .form-input:focus {
            outline: none;
            border-color: #64b5f6;
            box-shadow: 0 0 10px rgba(100, 181, 246, 0.3);
        }

        /* Mobile responsiveness for modals */
        @media (max-width: 768px) {
            .game-modal-container {
                min-width: 90vw;
                max-height: 90vh;
            }
            
            .avatar-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .color-picker-group {
                flex-direction: column;
            }
        }

        /* Warp confirmation dialog styles */
        .warp-confirmation h3 {
            color: #8a2be2;
            margin-bottom: 15px;
        }

        .warp-info {
            background: rgba(138, 43, 226, 0.1);
            border: 1px solid #8a2be2;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
        }

        .warp-info p {
            margin: 5px 0;
            color: #ffffff;
        }

        .warp-warning {
            background: rgba(255, 165, 0, 0.2);
            border: 1px solid #ffa500;
            border-radius: 5px;
            padding: 8px;
            margin: 10px 0;
            text-align: center;
            color: #ffa500;
            font-size: 0.9em;
        }

        /* Warp target selection modal styles */
        .warp-target-modal .modal-content {
            max-width: 600px;
            max-height: 70vh;
        }

        .warp-target-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .warp-target-header {
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 1px solid rgba(138, 43, 226, 0.3);
            padding-bottom: 10px;
        }

        .warp-target-header h3 {
            color: #8a2be2;
            margin: 0 0 5px 0;
        }

        .warp-target-header p {
            color: #cccccc;
            margin: 0;
            font-size: 0.9em;
        }

        .warp-target-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .warp-target-option:hover {
            background: rgba(138, 43, 226, 0.1);
            border-color: #8a2be2;
            transform: translateY(-1px);
        }

        .warp-target-info {
            flex-grow: 1;
        }

        .warp-target-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 4px;
        }

        .warp-target-details {
            display: flex;
            gap: 15px;
            font-size: 0.85em;
        }

        .warp-target-type {
            color: #8a2be2;
            font-weight: 500;
        }

        .warp-target-distance {
            color: #cccccc;
        }

        .warp-target-action {
            margin-left: 15px;
        }

        .warp-select-btn {
            background: linear-gradient(45deg, #8a2be2, #6a1b9a);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .warp-select-btn:hover {
            background: linear-gradient(45deg, #9c27b0, #7b1fa2);
            transform: scale(1.05);
        }

        .warp-select-btn:active {
            transform: scale(0.95);
        }

        /* Mining and cargo UI styles */
        .resource-selection-modal .modal-content {
            max-width: 500px;
            max-height: 60vh;
        }

        .resource-selection-list {
            max-height: 350px;
            overflow-y: auto;
        }

        .resource-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .resource-option:hover {
            background: rgba(139, 69, 19, 0.1);
            border-color: #8B4513;
        }

        .resource-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 4px;
        }

        .resource-details {
            display: flex;
            gap: 15px;
            font-size: 0.85em;
        }

        .resource-amount {
            color: #4CAF50;
            font-weight: 500;
        }

        .resource-distance {
            color: #cccccc;
        }

        .mine-select-btn {
            background: linear-gradient(45deg, #8B4513, #A0522D);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .mine-select-btn:hover {
            background: linear-gradient(45deg, #A0522D, #CD853F);
            transform: scale(1.05);
        }

        /* Cargo display styles */
        .cargo-modal .modal-content {
            max-width: 450px;
            max-height: 70vh;
        }

        .cargo-display {
            max-height: 400px;
            overflow-y: auto;
        }

        .cargo-summary {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 5px;
        }

        .capacity-bar {
            position: relative;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .capacity-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #FFC107, #FF5722);
            transition: width 0.3s ease;
        }

        .capacity-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ffffff;
            font-weight: bold;
            font-size: 0.85em;
        }

        .cargo-empty {
            text-align: center;
            padding: 30px;
            color: #999999;
        }

        .cargo-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .cargo-item-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .cargo-icon {
            font-size: 1.5em;
        }

        .cargo-name {
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 2px;
        }

        .cargo-stats {
            font-size: 0.85em;
            color: #cccccc;
        }

        .cargo-value {
            font-size: 0.9em;
            color: #FFC107;
            font-weight: 500;
        }

        /* Map expand button */
        .map-expand-btn {
            background: rgba(100, 181, 246, 0.2);
            border: 1px solid rgba(100, 181, 246, 0.4);
            color: #64b5f6;
            border-radius: 3px;
            padding: 2px 6px;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .map-expand-btn:hover {
            background: rgba(100, 181, 246, 0.3);
            border-color: rgba(100, 181, 246, 0.6);
        }

        /* Full map modal styles */
        .map-modal {
            max-width: 90vw;
            max-height: 85vh;
            width: 1000px;
            height: 700px;
        }

        .map-modal .modal-content {
            padding: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        /* Player assets modal styles */
        .player-assets-modal .modal-content {
            max-width: 700px;
            max-height: 80vh;
        }

        .player-assets-display {
            font-family: inherit;
        }

        .assets-system-section {
            margin-bottom: 25px;
        }

        .assets-system-section h3 {
            color: #64b5f6;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid rgba(100, 181, 246, 0.3);
            padding-bottom: 5px;
        }

        .asset-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .asset-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .asset-name {
            font-weight: bold;
            color: #ffffff;
        }

        .asset-position {
            color: #b0bec5;
            font-size: 0.9em;
        }

        .asset-cargo {
            color: #e0e0e0;
            font-size: 0.9em;
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .assets-summary-section {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 2px solid rgba(100, 181, 246, 0.3);
        }

        .assets-summary-section h3 {
            color: #4caf50;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .resource-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .resource-summary-item {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 6px;
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .resource-name {
            color: #ffffff;
            font-size: 0.9em;
        }

        .resource-quantity {
            color: #4caf50;
            font-weight: bold;
        }

        /* Transfer system styles */
        .transfer-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid rgba(100, 181, 246, 0.3);
        }

        .transfer-section h4 {
            color: #64b5f6;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .transfer-section p {
            color: #b0bec5;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .transfer-target-btn {
            display: block;
            width: 100%;
            background: rgba(100, 181, 246, 0.1);
            border: 1px solid rgba(100, 181, 246, 0.3);
            color: #ffffff;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 5px;
            font-size: 0.9em;
            transition: all 0.2s;
        }

        .transfer-target-btn:hover {
            background: rgba(100, 181, 246, 0.2);
            border-color: rgba(100, 181, 246, 0.5);
        }

        /* Transfer modal styles */
        .transfer-modal .modal-content {
            max-width: 500px;
            max-height: 70vh;
        }

        .transfer-display {
            font-family: inherit;
        }

        .transfer-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .transfer-item-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .transfer-details {
            display: flex;
            flex-direction: column;
        }

        .transfer-name {
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 2px;
        }

        .transfer-available {
            color: #b0bec5;
            font-size: 0.9em;
        }

        .transfer-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .transfer-quantity {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            padding: 4px 8px;
            border-radius: 4px;
            width: 60px;
            font-size: 0.9em;
        }

        .transfer-quantity:focus {
            border-color: #64b5f6;
            outline: none;
        }

        .transfer-btn {
            background: linear-gradient(45deg, #4caf50, #45a049);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.2s;
        }

        .transfer-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(76, 175, 80, 0.3);
        }

        .map-tabs {
            display: flex;
            background: rgba(40, 40, 60, 0.9);
            border-bottom: 1px solid #444;
            padding: 0;
        }

        .map-tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: #888;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
        }

        .map-tab:hover {
            color: #64b5f6;
            background: rgba(100, 181, 246, 0.1);
        }

        .map-tab.active {
            color: #64b5f6;
            background: rgba(100, 181, 246, 0.2);
            border-bottom-color: #64b5f6;
        }

        .map-tab-content {
            flex: 1;
            padding: 20px;
            overflow: auto;
        }

        .map-tab-content.hidden {
            display: none;
        }

        .full-map-canvas {
            border: 1px solid #444;
            border-radius: 4px;
            width: 100%;
            height: 500px;
        }

        .galaxy-systems-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .galaxy-system-card {
            background: rgba(100, 181, 246, 0.1);
            border: 1px solid rgba(100, 181, 246, 0.3);
            border-radius: 6px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .galaxy-system-card:hover {
            background: rgba(100, 181, 246, 0.2);
            border-color: rgba(100, 181, 246, 0.5);
        }

        .galaxy-system-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #64b5f6;
            margin-bottom: 8px;
        }

        .galaxy-system-info {
            font-size: 0.9em;
            color: #ccc;
            line-height: 1.4;
        }

        /* Build Modal Styles */
        .build-modal {
            max-width: 800px;
            width: 100%;
        }

        .build-tabs {
            display: flex;
            background: rgba(40, 40, 60, 0.9);
            border-bottom: 1px solid #444;
            padding: 0;
            margin-bottom: 20px;
        }

        .build-tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: #888;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
            font-size: 1em;
        }

        .build-tab:hover {
            color: #64b5f6;
            background: rgba(100, 181, 246, 0.1);
        }

        .build-tab.active {
            color: #64b5f6;
            background: rgba(100, 181, 246, 0.2);
            border-bottom-color: #64b5f6;
        }

        .build-resources {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .resource-display {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1em;
        }

        .resource-icon {
            font-size: 1.2em;
        }

        .resource-name {
            color: #ccc;
        }

        .resource-quantity {
            color: #4caf50;
            font-weight: bold;
        }

        .build-tab-content {
            min-height: 400px;
        }

        .build-tab-content.hidden {
            display: none;
        }

        .build-section h3 {
            color: #64b5f6;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .build-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .build-option {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.2s ease;
        }

        .build-option:hover:not(.disabled) {
            background: rgba(100, 181, 246, 0.1);
            border-color: rgba(100, 181, 246, 0.3);
        }

        .build-option.disabled {
            opacity: 0.5;
            background: rgba(255, 255, 255, 0.02);
        }

        .build-info {
            flex: 1;
            margin-right: 20px;
        }

        .build-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #64b5f6;
            margin-bottom: 8px;
        }

        .build-description {
            color: #ccc;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .build-stats {
            color: #888;
            font-size: 0.85em;
            line-height: 1.4;
        }

        .build-cost {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
            min-width: 120px;
        }

        .cost-item {
            color: #ffa726;
            font-weight: bold;
            font-size: 0.9em;
        }

        .build-btn {
            background: linear-gradient(45deg, #4caf50, #45a049);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.2s;
            min-width: 80px;
        }

        .build-btn:hover:not(.disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .build-btn.disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Cargo Actions and Deploy Button */
        .cargo-actions {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
            min-width: 120px;
        }

        .deploy-btn {
            background: linear-gradient(45deg, #2196f3, #1976d2);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: bold;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .deploy-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(33, 150, 243, 0.3);
        }

        /* Sector Selection Modal */
        .sector-selection-modal {
            max-width: 600px;
            width: 100%;
        }

        .sector-selection-header {
            margin-bottom: 20px;
            text-align: center;
        }

        .sector-selection-header h3 {
            color: #64b5f6;
            margin-bottom: 10px;
        }

        .sector-selection-header p {
            color: #ccc;
            margin: 0;
        }

        .sector-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px 0;
        }

        .sector-option {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .sector-option:hover {
            background: rgba(100, 181, 246, 0.1);
            border-color: rgba(100, 181, 246, 0.3);
            transform: translateX(5px);
        }

        .sector-info {
            flex: 1;
        }

        .sector-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #64b5f6;
            margin-bottom: 5px;
        }

        .sector-details {
            color: #ccc;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .sector-action {
            display: flex;
            align-items: center;
        }

        .select-sector-btn {
            background: linear-gradient(45deg, #9c27b0, #7b1fa2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.2s;
        }

        .select-sector-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(156, 39, 176, 0.3);
        }

        /* Interstellar Travel Modal */
        .interstellar-travel-modal {
            max-width: 500px;
            width: 100%;
        }

        .travel-header {
            margin-bottom: 20px;
            text-align: center;
        }

        .travel-header h3 {
            color: #64b5f6;
            margin-bottom: 10px;
        }

        .travel-header p {
            color: #ccc;
            margin: 0;
        }

        .gate-list {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px 0;
        }

        .gate-option {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .gate-option:hover {
            background: rgba(100, 181, 246, 0.1);
            border-color: rgba(100, 181, 246, 0.3);
            transform: translateX(5px);
        }

        .gate-info {
            flex: 1;
        }

        .gate-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #64b5f6;
            margin-bottom: 5px;
        }

        .gate-destination {
            color: #ccc;
            font-size: 0.9em;
        }

        .gate-action {
            display: flex;
            align-items: center;
        }

        .travel-btn {
            background: linear-gradient(45deg, #ff5722, #e64a19);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.2s;
        }

        .travel-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(255, 87, 34, 0.3);
        }

        /* Multi-Sector Fleet Styles */
        .sector-group {
            margin-bottom: 15px;
        }

        .sector-header {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 5px;
            font-size: 0.9em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sector-header.current-sector {
            background: rgba(100, 181, 246, 0.2);
            border: 1px solid rgba(100, 181, 246, 0.3);
            color: #64b5f6;
        }

        .sector-icon {
            font-size: 1em;
        }

        .sector-name {
            flex: 1;
        }

        .unit-count {
            color: #888;
            font-size: 0.8em;
        }

        .sector-units {
            padding-left: 10px;
        }

        .unit-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .unit-item:hover {
            background: rgba(100, 181, 246, 0.1);
            border-color: rgba(100, 181, 246, 0.3);
            transform: translateX(3px);
        }

        .unit-item.selected {
            background: rgba(100, 181, 246, 0.2);
            border-color: rgba(100, 181, 246, 0.5);
        }

        .unit-item.remote-unit {
            opacity: 0.8;
            border-style: dashed;
        }

        .unit-item.remote-unit:hover {
            opacity: 1;
        }

        .unit-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }

        .unit-icon {
            font-size: 1.1em;
        }

        .unit-name {
            flex: 1;
            font-weight: bold;
            color: #64b5f6;
        }

        .remote-indicator {
            color: #ffa726;
            font-size: 0.9em;
        }

        .unit-stats {
            font-size: 0.85em;
            color: #ccc;
            line-height: 1.3;
        }

        .unit-stats div {
            margin-bottom: 2px;
        }

        .no-units {
            text-align: center;
            color: #888;
            padding: 20px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Top Bar -->
        <div class="top-bar sf-card">
            <div class="game-info">
                <div class="game-title" id="gameTitle">🌌 Starfront: Dominion</div>
                <div class="turn-status">
                    <div class="turn-counter" id="turnCounter">Turn 1</div>
                    <button class="lock-turn-btn sf-btn sf-btn-primary" id="lockTurnBtn" onclick="toggleTurnLock()">
                        🔓 Lock Turn
                    </button>
                </div>
            </div>
            <div>
                <button class="map-btn sf-btn sf-btn-secondary" onclick="showSettings()">⚙️</button>
                <button class="map-btn sf-btn sf-btn-danger" onclick="exitGame()">❌</button>
            </div>
        </div>
        
        <!-- Left Panel - Player & Units -->
        <div class="left-panel sf-card">
            <!-- Player Section -->
            <div class="player-section">
                <div class="player-avatar">
                    <img id="playerAvatar" src="" alt="Player Avatar" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiM2NGI1ZjYiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4PSI4IiB5PSI4Ij4KPHBhdGggZD0iTTEyIDJDMTMuMSAyIDE0IDIuOSAxNCA0QzE0IDUuMSAxMy4xIDYgMTIgNkMxMC45IDYgMTAgNS4xIDEwIDRDMTAgMi45IDEwLjkgMiAxMiAyWk0yMSAxOVYyMEgzVjE5TDUgMTcuMjVWMTFIMTBWMTIuNUgxNFYxMUgxOVYxNy4yNUwyMSAxOVoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo8L3N2Zz4K';">
                </div>
                <button class="player-assets-btn sf-btn sf-btn-secondary" onclick="showPlayerAssets()">
                    📊 Player Assets
                </button>
            </div>
            
            <!-- Fleet Section -->
            <div class="panel-title">🚢 Your Fleet</div>
            <div id="unitsList" class="loading">Loading units...</div>
        </div>
        
        <!-- Center Map -->
        <div class="map-container sf-card">
            <canvas id="gameCanvas"></canvas>
            <div class="map-controls">
                <button class="map-btn sf-btn sf-btn-secondary" onclick="zoomIn()">🔍+</button>
                <button class="map-btn sf-btn sf-btn-secondary" onclick="zoomOut()">🔍-</button>
                <button class="map-btn sf-btn sf-btn-secondary" onclick="gameClient.toggleFloatingMiniMap()">🎯</button>
                <button class="map-btn sf-btn sf-btn-secondary" onclick="openMapModal()" title="Open Full Map">🗺️</button>
            </div>
        </div>
        
        <!-- Right Panel - Selected Unit Info -->
        <div class="right-panel sf-card">
            <div class="panel-title">📊 Unit Details</div>
            <div id="unitDetails">
                <div style="text-align: center; color: #666; padding: 20px;">
                    Select a unit to view details
                </div>
            </div>
        </div>
        
        <!-- Bottom: Mini Map + Log/Chat side-by-side -->
        <div class="mini-map sf-card" style="grid-area:auto; grid-column: 2 / span 1; min-height:0;">
            <div style="font-size: 0.9em; margin-bottom: 6px; color: var(--primary); display: flex; align-items: center; gap: 8px; justify-content: flex-start;">
                <span id="sectorOverviewTitle">Sector Overview</span>
                <button class="map-expand-btn sf-btn sf-btn-secondary" onclick="openMapModal()" title="Open Full Map">🗺️</button>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px; height: 100%; min-height: 0;">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px; min-height:0;">
                    <div style="display:grid; grid-template-rows: auto 1fr auto; gap:6px; min-height:0;">
                        <div class="panel-title" style="margin:0;">💬 Chat</div>
                        <div id="chatMessages" style="overflow:auto; min-height:0; background:#0b0f1a; border:1px solid #243b55; border-radius:6px; padding:8px; color:#cfe4ff;"></div>
                    <div style="display:grid; grid-template-columns: auto 110px 1fr auto; gap:6px; align-items:center;" onsubmit="return false;">
                            <select id="chatScope" class="sf-select">
                                <option value="game">Game</option>
                                <option value="dm">Direct</option>
                            </select>
                            <input id="chatToUserId" class="sf-input" placeholder="User ID (DM)" />
                            <input id="chatInput" class="sf-input" placeholder="Type a message" />
                        <button onclick="sendChat()" class="sf-btn sf-btn-secondary" id="chatSendBtn">Send</button>
                        </div>
                    </div>
                    <div style="display:grid; grid-template-rows: auto 1fr; gap:6px; min-height:0;">
                        <div class="panel-title" style="margin:0;">📜 Activity Log</div>
                        <div id="activityLog" style="overflow:auto; min-height:0;">
                            <div class="log-entry info">Game initialized. Welcome to your sector, Commander!</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="main.js"></script>
    <script src="game.js"></script>
    
    <script>
        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', () => {
            if (Session.requireAuth()) {
                const gameId = new URLSearchParams(window.location.search).get('id');
                if (gameId) {
                    initializeGame(gameId);
                } else {
                    window.location.href = 'lobby.html';
                }
            }
        });
        
        function showSettings() {
            alert('Settings coming soon!\n\n• Graphics options\n• Sound controls\n• Keybindings');
        }
        
        function exitGame() {
            if (confirm('Are you sure you want to exit the game?')) {
                window.location.href = 'lobby.html';
            }
        }
        // Basic chat client wiring
        function appendChat(msg) {
            const box = document.getElementById('chatMessages');
            if (!box) return;
            const line = document.createElement('div');
            line.style.margin = '2px 0';
            const scope = msg.channelId ? `[#${msg.channelId}]` : (msg.toUserId ? `(DM→${msg.toUserId})` : '(Game)');
            line.textContent = `[${new Date(msg.timestamp).toLocaleTimeString()}] ${scope} ${msg.fromUserId}: ${msg.text}`;
            box.appendChild(line);
            box.scrollTop = box.scrollHeight;
        }
        function sendChat() {
            if (!window.gameClient || !gameClient.socket) return;
            const text = document.getElementById('chatInput').value.trim();
            if (!text) return;
            const scope = document.getElementById('chatScope').value;
            const toUserId = document.getElementById('chatToUserId').value.trim();
            const payload = { gameId: gameClient.gameId, fromUserId: gameClient.userId, text };
            if (scope === 'dm' && toUserId) payload.toUserId = Number(toUserId);
            gameClient.socket.emit('chat:send', payload);
            document.getElementById('chatInput').value = '';
            // Optimistic append for game-wide messages
            if (window.appendChat && scope === 'game') {
                window.appendChat({ fromUserId: gameClient.userId, text, timestamp: new Date().toISOString() });
            }
        }
        // Enter to send
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey && document.activeElement === document.getElementById('chatInput')) {
                e.preventDefault();
                sendChat();
            }
        });
    </script>
</body>
</html> 